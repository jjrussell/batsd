$(document).ready(function() {

  var _t = window.i18n.t;
  
  // Login Modal
  $('#login, #login-web').bind('click', function() {
    if ($('#login-form').hasClass('show')) {
      $('#login-form').removeClass('show');
    }
    else {
      $('#login-form').addClass('show').css({ 
        'height' : $(document).height(),
      });
    }
  });
  
  $('#login-form .cancel-btn').bind('click', function() {
    $('#login-form').removeClass('show');
  });
  
  // Login Validation
  if ($('form#new_gamer_session')) {
    $('form#new_gamer_session input').focus(function() {
      $('form#new_gamer_session .login-error').empty();
    });
    $('form#new_gamer_session').submit(function(e){
      Tapjoy.Utils.Cookie.set('cookies_enabled', 'test', 1);
      var test_cookie = Tapjoy.Utils.Cookie.get('cookies_enabled');
      $(".form-error").hide();
      var inputs, email, pass, values = {};
      var emailRegex = /^([\w-\.+]+@([\w-]+\.)+[\w-]{2,4})?$/;
      inputs = $('form#new_gamer_session :input*');
      inputs.each(function() {
        if (this.type == 'checkbox' || this.type == 'radio') {
          values[this.name] = $(this).attr("checked");
        }
        else {
          values[this.name] = $(this).val();
        }
      });
      email = values['gamer_session[email]'];
      pass = values['gamer_session[password]'];
      if (Tapjoy.Utils.isEmpty(email) || email == 'Email') {
        $(".login-error").html(_t('games.enter_email'));
        $(".form-error").show();
        e.preventDefault();
      }
      else if (Tapjoy.Utils.isEmpty(pass) || pass == 'Password') {
        $(".login-error").html(_t('games.enter_password'));
        $(".form-error").show();
        e.preventDefault();
      }
      else if (Tapjoy.Utils.isEmpty(test_cookie)) {
        $(".login-error").html(_t('games.cookies_required'));
        $(".form-error").show();
        e.preventDefault();
      }
      else {
        Tapjoy.Utils.Cookie.delete('cookies_enabled');
      }
    });
  }
  
  // Menu Grid
  $('.menu-grid').bind('click', function(){
    if ($(this).hasClass('active')) {
      $(this).removeClass('active');
      $('.menu-dropdown').removeClass('open').addClass('close');
    }
    else {
      $(this).addClass('active');
      $('.menu-dropdown').removeClass('close').addClass('open');
    }
  });
  
  // Menu - Device Toggle
  $('.device-toggle').bind('click', function(){
    if ($(this).hasClass('up')) {
      $(this).removeClass('up').addClass('down');
    }
    else {
      $(this).removeClass('down').addClass('up');
    }
  });
  
  // Device switch toggle
  $('.device-change').bind('click', function(){
    if ($('.device-select').hasClass('open')) {
      $('.device-select').removeClass('open').addClass('closed');
    }
    else {
      $('.device-select').removeClass('closed').addClass('open');
    }
  });
  
  // App Icons
  $('.app-icon img').each(function(n, o){
    var el = $(o);
    el.attr("src", el.attr("source"));
    el.load(function(){
      $(this).fadeIn('slow');
    });
    el.error(function(){
      el.attr("src", "data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==");
    });
  });

<<<<<<< HEAD
  // Button bar
  
  
  Tapjoy.Plugins = {
    
    showAddHomeDialog : function() {
      var startY = startX = 0,
        boldText = TJG.utils.sprintfTemplate("<span class='bold'>%s</span>"),
      options = {
        message: '<div>'+
            _t('games.add_to_homescreen', {
              tapjoy: boldText("Tapjoy")
            })+
          '</div><div class="bookmark"><span>'+
            _t("games.tap_that", {
              icon:'</span><span class="bookmark_icon"></span><span>', 
              button:'</span><span class="bookmark_btn"></span><span>'
            })+
          '</span></div>',
        animationIn: 'fade',
        animationOut: 'fade',
        startDelay: 2000,
        lifespan: 10000,
        bottomOffset: 14,
        expire: 0,
        arrow: true,
        iterations: 5
      },
      theInterval, closeTimeout, el, i, l,
      expired = TJG.utils.getLocalStorage("tjg.bookmark.expired"),
      shown = TJG.utils.getLocalStorage("tjg.bookmark.shown");
      if (TJG.utils.isNull(shown)) {
        shown = 0;
      }
      shown = parseInt(shown);
      if (expired == "true") {
        return;
      }
      if (shown >= 4) {
        TJG.utils.setLocalStorage("tjg.bookmark.expired", "true");
      }
      TJG.vars.version =  TJG.vars.version ?  TJG.vars.version[0].replace(/[^\d_]/g,'').replace('_','.')*1 : 0;
      expired = expired == 'null' ? 0 : expired*1;
      var div = document.createElement('div'), close;
      div.id = 'addToHome';
      div.style.cssText += 'position:absolute;-webkit-transition-property:-webkit-transform,opacity;-webkit-transition-duration:0;-webkit-transform:translate3d(0,0,0);';
      div.style.left = '-9999px';
      div.className = (TJG.vars.isIPad ? 'ipad wide' : 'iphone');
      var m =  options.message;
      var a = (options.arrow ? '<span class="arrow"></span>' : '');
      var t = [
        m,
        a
      ].join('');
      div.innerHTML = t;
      document.body.appendChild(div);
      el = div;

      function transitionEnd () {
        el.removeEventListener('webkitTransitionEnd', transitionEnd, false);
        el.style.webkitTransitionProperty = '-webkit-transform';
        el.style.webkitTransitionDuration = '0.2s';
        if (closeTimeout) {
          clearInterval(theInterval);
          theInterval = setInterval(setPosition, options.iterations);
        }
        else {
          el.parentNode.removeChild(el);
        }
      }
      function setPosition () {
        var matrix = new WebKitCSSMatrix(window.getComputedStyle(el, null).webkitTransform),
        posY = TJG.vars.isIPad ? window.scrollY - startY : window.scrollY + window.innerHeight - startY,
        posX = TJG.vars.isIPad ? window.scrollX - startX : window.scrollX + Math.round((window.innerWidth - el.offsetWidth)/2) - startX;
        if (posY == matrix.m42 && posX == matrix.m41) return;
        clearInterval(theInterval);
        el.removeEventListener('webkitTransitionEnd', transitionEnd, false);
        setTimeout(function () {
          el.addEventListener('webkitTransitionEnd', transitionEnd, false);
          el.style.webkitTransform = 'translate3d(' + posX + 'px,' + posY + 'px,0)';
        }, 0);
      }
      function addToHomeClose () {
        clearInterval(theInterval);
        clearTimeout(closeTimeout);
        closeTimeout = null;
        el.removeEventListener('webkitTransitionEnd', transitionEnd, false);
        var posY = TJG.vars.isIPad ? window.scrollY - startY : window.scrollY + window.innerHeight - startY,
        posX = TJG.vars.isIPad ? window.scrollX - startX : window.scrollX + Math.round((window.innerWidth - el.offsetWidth)/2) - startX,
        opacity = '0.95',
        duration = '0';
        el.style.webkitTransitionProperty = '-webkit-transform,opacity';
        switch (options.animationOut) {
          case 'drop':
          if (TJG.vars.isIPad) {
            duration = '0.4s';
            opacity = '0';
            posY = posY + 50;
          } else {
            duration = '0.6s';
            posY = posY + el.offsetHeight + options.bottomOffset + 50;
          }
          break;
          case 'bubble':
          if (TJG.vars.isIPad) {
            duration = '0.8s';
            posY = posY - el.offsetHeight - options.bottomOffset - 50;
          }
          else {
            duration = '0.4s';
            opacity = '0';
            posY = posY - 50;
          }
          break;
          default:
          duration = '0.8s';
          opacity = '0';
        }
        el.addEventListener('webkitTransitionEnd', transitionEnd, false);
        el.style.opacity = opacity;
        el.style.webkitTransitionDuration = duration;
        el.style.webkitTransform = 'translate3d(' + posX + 'px,' + posY + 'px,0)';
      }
      setTimeout(function () {
        var duration;
        startY = TJG.vars.isIPad  ? window.scrollY : window.innerHeight + window.scrollY;
        startX = TJG.vars.isIPad  ? window.scrollX : Math.round((window.innerWidth - el.offsetWidth)/2) + window.scrollX;
        el.style.top = TJG.vars.isIPad ? startY + options.bottomOffset + 'px' : startY - el.offsetHeight - options.bottomOffset + 'px';
        el.style.left = TJG.vars.isIPad ? startX + (TJG.vars.version >=5 ? 160 : 208) - Math.round(el.offsetWidth/2) + 'px' : startX + 'px';
        switch (options.animationIn) {
          case 'drop':
          if (TJG.vars.isIPad) {
            duration = '0.6s';
            el.style.webkitTransform = 'translate3d(0,' + -(window.scrollY + options.bottomOffset + el.offsetHeight) + 'px,0)';
          }
          else {
            duration = '0.9s';
            el.style.webkitTransform = 'translate3d(0,' + -(startY + options.bottomOffset) + 'px,0)';
          }
          break;
          case 'bubble':
          if (TJG.vars.isIPad) {
            duration = '0.6s';
            el.style.opacity = '0'
            el.style.webkitTransform = 'translate3d(0,' + (startY + 50) + 'px,0)';
          }
          else {
            duration = '0.6s';
            el.style.webkitTransform = 'translate3d(0,' + (el.offsetHeight + options.bottomOffset + 50) + 'px,0)';
          }
          break;
          default:
          duration = '1s';
          el.style.opacity = '0';
        }
        setTimeout(function () {
          el.style.webkitTransitionDuration = duration;
          el.style.opacity = '0.95';
          shown = shown + 1;
          TJG.utils.setLocalStorage("tjg.bookmark.shown", shown);
          el.style.webkitTransform = 'translate3d(0,0,0)';
          el.addEventListener('webkitTransitionEnd', transitionEnd, false);
          }, 0);
          closeTimeout = setTimeout(addToHomeClose, options.lifespan);
      }, options.startDelay);
      window.addToHomeClose = addToHomeClose;
    }
    
  }

  $(".button-bar").each(function () {
    var $$ = $(this),
      radios = $(":radio", $$),
      buttons = $(".ui-joy-button", $$),
      value = $(":checked", $$).val(),
      render_state;

    render_state = function () {
      $(".active", $$).removeClass("active");
      $(":checked").attr("checked", false);

      $(".ui-joy-button[value='" + value + "']", $$).addClass("active");
      $("[value='" + value + "']:radio", $$).attr("checked", "checked");
    };

    $(".ui-joy-button", $$).click(function () {
      value = $(this).attr("value");

      render_state();
    });
    render_state();
  });


  $('.toggle').bind(Tapjoy.EventsMap.start, function(){
		var el = $(this),
		    img = $('img', el),
		    content = $(this).parent().next('div');
				
		if(img.hasClass('uparrow')){
		 img.removeClass('uparrow').addClass('downarrow');
     content.removeClass('hide');
		}else{
			img.removeClass('downarrow').addClass('uparrow')
	    content.addClass('hide');
		}
	});
	
	$('.list-button').bind(Tapjoy.EventsMap.start + ' ' + Tapjoy.EventsMap.end, function(e){
		var el = $(this),
		    which = e.type;
				
		if(which === Tapjoy.EventsMap.start){
			el.addClass('active');
		}else{
			el.removeClass('active');
		}
	});

=======
>>>>>>> 72758894f1a8e9899c9d0e1e9cf3b0c4f9c6e3c8
	/*
	Tapjoy.Utils.notification({
		message: 'Thanks, your settings have been saved.'
	});

  Tapjoy.delay(function(){
	  Tapjoy.Utils.notification({
	    message: 'Thanks, we would like to save hello again.'
	  });
	}, 4000);
	*/
});
