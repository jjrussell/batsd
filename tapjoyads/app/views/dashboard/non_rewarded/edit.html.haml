- @page_title = 'Publish Non-Rewarded'

%h3
  = @page_title

- if @currency.errors.any?
  .errors
    %span There were errors making your changes
    %ul
      - @currency.errors.each do |error|
        %li= error.join(": ")

= form_for [@app, @currency], :url => { :action => 'update' }, :html => {:class => 'tjform'} do |f|
  %table.currency_form
    %tr
      %th
        = f.label :test_devices, 'Test devices'
        #help_test_devices.help ?
      %td
        = f.text_area :test_devices
        = error_message_on(@currency, :test_devices)
    %tr
      %th
        = f.label :minimum_offerwall_bid, 'Minimum offerwall bid'
        #help_minimum_offerwall_bid.help ?
      %td
        = f.currency_field :minimum_offerwall_bid
        = error_message_on(@currency, :minimum_offerwall_bid)
    %tr
      %th
        = f.label :minimum_featured_bid, 'Minimum featured bid'
        #help_minimum_featured_bid.help ?
      %td
        = f.currency_field :minimum_featured_bid
        = error_message_on(@currency, :minimum_featured_bid)
    %tr
      %th
        = f.label :minimum_display_bid, 'Minimum display ad bid'
        #help_minimum_display_bid.help ?
      %td
        = f.currency_field :minimum_display_bid
        = error_message_on(@currency, :minimum_display_bid)
    %tr
      %th
        Tapjoy Enabled
        #help_enabled.help ?
      %td
        - if @currency.tapjoy_enabled?
          .tapjoy-enabled Enabled
        - else
          .tapjoy-disabled Disabled
    %tr
      %th
        Non-Rewarded ID
        #help_nonreward_currency_id.help ?
      %td
        = @currency.id


    - if permitted_to?(:edit, :dashboard_statz)
      = render :partial => 'dashboard/currencies/admin_fields', :locals => {:f => f}
    %tr
      %td{ :colspan => 2 }= f.submit 'Save'

  - if @udids_to_check.present?
    %h3
      Test Device Last-run time(s)
      #help_test_device_last_run_time.help ?
    %table
      %tr
        %th UDID
        %th Last run time
      - @udids_to_check.each do |arr|
        %tr
          %td= arr[0]
          %td= arr[1]

    - if @currency.tapjoy_managed?
      %h3
        Reset Test Device Virtual Goods
        #help_reset_test_devices.help ?
      = form_tag({:action => 'reset_test_device'}, {:class => 'tjform'}) do
        %table
          %tbody
            %tr
              %th= label_tag :udid, "Device ID"
              %td= select_tag 'udid', options_for_select(@currency.get_test_device_ids.to_a)
            %tr
              %th
                = label_tag :reset_balance, "Reset Balance"
                #help_reset_test_device_balance.help ?
              %td= check_box_tag :reset_balance
            %tr
              %td{ :colspan => 2 }= submit_tag('Reset this device')

.hidden
  #help_test_devices_content{:name => 'Test devices'}
    A semicolon (;) separated list of test device IDs (UDID/MEID/IMEI). These devices will see beta virtual goods and a special test offer at the top of the available offers list.
  #help_reset_test_devices_content{:name => 'Reset Virtual Goods'}
    Remove all virtual good purchases from a test device and optionally reset the balance.
  #help_test_device_last_run_time_content{:name => 'Test device last run time'}
    Displays the last time a test device ran this app.
  #help_minimum_offerwall_bid_content{:name => 'Minimum offerwall bid'}
    If you are displaying an offerwall, only offers with a bid higher than this will be shown.
  #help_minimum_featured_bid_content{:name => 'Minimum featured bid'}
    If you are displaying featured offers, only featured offers with a bid higher than this will be shown.
  #help_minimum_display_bid_content{:name => 'Minimum display ad bid'}
    If you are displaying banner ads, only offers with a bid higher than this will be shown.
  #help_reset_test_device_balance_content{:name => 'Reset Balance'}
    Sets the device's balance back to the currency's initial value.
  #help_enabled_content{:name => 'Tapjoy Enabled'}
    Tapjoy approval status. Users will NOT be able to earn currency until this is enabled.
    Please email publishersupport@tapjoy.com to get approval.
  #help_nonreward_currency_id_content{:name => 'Non-Rewarded ID'}
    This is the currency ID for non-rewarded publishing.

- content_for :page_javascript do
  :plain
    $(function($){
      $('#managed_by_tapjoy').change(toggleManagedByTapjoy);
      $('#currency_name').keyup(copyCurrencyName);
      $('#generate_link').click(generateSecretKey);

      toggleManagedByTapjoy();
      copyCurrencyName();

    });

    function copyCurrencyName() {
      $('#currency_name_text').text($('#currency_name').val());
    }
    function toggleManagedByTapjoy() {
      if ($('#managed_by_tapjoy').attr('checked')) {
        $('.managed').show();
        $('.unmanaged').hide();
      } else {
        $('.managed').hide();
        $('.unmanaged').show();
        if ($('#currency_callback_url').val() == '#{Currency::TAPJOY_MANAGED_CALLBACK_URL}') {
          $('#currency_callback_url').val('');
        }
      }
    }
    function generateSecretKey() {
      var values = [];
      for (var i = 0; i < 10; i++) {
        values.push(i);
      }
      for (var i = 0; i < 26; i++) {
        values.push(String.fromCharCode(65 + i));
      }
      for (var i = 0; i < 26; i++) {
        values.push(String.fromCharCode(97 + i));
      }

      key = [];
      for (var i = 0; i < 20; i++) {
        key.push(values[Math.floor(Math.random() * values.length)])
      }

      $('#currency_secret_key').val(key.join(''));
    }

- content_for :page_styles do
  :plain
    textarea {
      height: 34px;
    }

    textarea,
    input[type=text] {
      width: 400px;
    }

    .managed,
    .unmanaged {
      display: hidden;
    }

    .box_with_right_label {
      position: relative;
    }

    .right_label {
      position: absolute;
      left: 100%;
      top: 4px;
      margin-left: 3px;
    }

    #generate_link {
      white-space: nowrap;
    }

    .tapjoy-enabled {
      color: #328F0D;
    }
    .tapjoy-disabled {
      color: #AF1515;
    }

    .currency_form {
      width: 680px;
    }

    .details {
      font-size: 12px;
    }
