- @page_title = t('text.instructions.title')
- amount_and_currency = content_tag(:b, t('text.instructions.amount_and_currency', :amount => @currency.get_visual_reward_amount(@offer, params[:display_multiplier]), :currency => @currency.name))
.ui-joy-mask
  .ui-joy-panel#panel
    .grey-box
      .app-logo
        = image_tag @offer.get_icon_url(:source => :cloudfront, :size => '57')
      .heading= @offer.name
    .instructions
      .content
        %ul.steps
          = instruction_list(@offer.instructions).html_safe
    .padit
      .reward-button.click-action
        - if @offer.item_type == 'ActionOffer'
          - if @action_app && @action_app.protocol_handler.present? && @device_type.match(/\A(android|ios|ipad|iphone|itouch)\z/)
            .button-holder
              %input{:value => t('text.instructions.earn_currency_html', :amount_and_currency => amount_and_currency), :type => :button, :id => 'protocol', :class => 'button gradient'}
          - else
            - download_action = link_to(t('text.instructions.earn_currency_html', :amount_and_currency => amount_and_currency), @complete_action_url)
            = t('text.instructions.download_link_html', :download_action => download_action)
        - else
          = link_to(t('text.instructions.earn_currency_html', :amount_and_currency => amount_and_currency), @complete_action_url, :class => 'continue')
    #adsby
      %span#presented_by
        = t('text.instructions.presented_by', :default => 'Presented By')
      #logo

- content_for :page_styles do
  :plain
    * {
      margin: 0;
      padding: 0;
      outline: 0;
      font-weight: inherit;
      font-style: inherit;
      font-size: inherit;
      font-family: inherit;
      vertical-align: baseline;
      text-decoration: none;
    }

    .gradient {
       filter: none;
    }

    .button-holder .button {
      background: url('/images/api/gray_button_tile.png') repeat-x 0 0 !important;
      padding: 7px;
      -moz-border-radius: 15px;
      border-radius: 15px;
    }

    body {
      margin-bottom: 10px;
      color: #004E09;
    }

    .button-holder {
      text-align: center;
      display: none;
    }

    img {
      border: 0;
    }

    @media (max-width:425px){
      .button-holder {
        .button {
          font-size: 90%;
        }
      }
    }

    #offers {
      margin: 50px 3% 10px 3%;
      background: white;
      border: 1px solid #d5d5d5;
      -moz-border-radius: 10px;
      -webkit-border-radius: 10px;
      padding: 10px;
    }

    .amount {
      color: rgb(0, 136, 16);
    }

    #privacy a {
      font-size: 75%;
      color: #004E09;
    }

    #privacy {
      float: left;
      margin-left: 5%;
      text-decoration: underline;
    }

    .clear {
      clear: both;
    }

    .hidden {
      display: none;
    }

    #header img {
      float: left;
      margin: 0 10px 0 0;
    }

    #header #action_name {
      height: 57px;
      display: table-cell;
      vertical-align: middle;
      padding-bottom: 10px;
    }

    #header {
      border-bottom: 2px solid;
    }

    #action_instructions {
      clear: both;
      margin-top: 10px;
      border-bottom: 2px solid;
    }

    .important {
      font-weight: bold;
      margin: 10px 0;
    }
    
    .instructions p {
      margin-bottom: 10px;
    }

    #footer {
      margin: 10px 0 0;
    }

    .continue {
      font-size: 24px;
    }

    #adsby {
      margin-top: 2px;
      text-align: center;
    }

    #adsby span { 
      display: inline-block; 
      font-size: 13px; 
      text-decoration: none; 
      vertical-align: top; 
    }

    #adsby #logo { 
      background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAVCAMAAADl7ZdoAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5QTg5Q0VGREY2MUUxMUUxOTJENUZCMTY3RDBBRjQwNSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5QTg5Q0VGRUY2MUUxMUUxOTJENUZCMTY3RDBBRjQwNSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjlBODlDRUZCRjYxRTExRTE5MkQ1RkIxNjdEMEFGNDA1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjlBODlDRUZDRjYxRTExRTE5MkQ1RkIxNjdEMEFGNDA1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+eDSZzQAAAUpQTFRFiYmJi4uLmZmZ8PDwwcHB7+/vxMTEtLS0srKykpKSkJCQ5ubmx8fHioqK7Ozsk5OTn5+f8/Pz09PTmJiY8vLy6Ojo2NjY+fn5/v7+6urq5OTkmpqa3Nzc/Pz86enpjIyM7e3tpKSkjo6O8fHx7u7uxcXFzc3NzMzMu7u7q6urqKiom5ubp6en1tbWz8/P+/v739/frKysv7+/2dnZqampkZGR0NDQl5eX6+vrs7OzwMDAubm5+Pj49fX1pqamwsLCyMjI+vr63d3dysrK1NTUvr6+jY2Nnp6e9PT0oKCgycnJlZWVtra2vLy8nJyc4+PjtbW1oaGhr6+vlJSUoqKipaWl9/f3nZ2d3t7eo6Ojw8PDy8vL0tLS1dXV/f3919fXj4+Pzs7O5+fnuLi4lpaWvb29t7e34eHh9vb2ra2t2traxsbGrq6u////49ha4AAAAG50Uk5T/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wCgBTwzAAABzUlEQVR42oyT1XLjQBBFryzZQsvMjDFTYoeZmZeZ6f7/645dtcnG69T6lKpb1ToPPdMtsKDcJhwOR70+jA8J7PIhWDgGIEmSiBlpDGyM2xrqs7Yspz2wgk6nLMvDMHxELm6O208xGOYFN+L8L3iOK/kN2YTho89Va6gx+fvnwZom09R6Ue7U9tUil7Rz2ovqAV4D+RCpwMv0PPLAVhxwA126UKMlzoTDVA4tLqMaBcNrZwdkF2rUC39Bd/viuM624ElpKPn2EDYl2Mt4HzGkECG6iZDtBMpx3NBGgDOYo4lAxItnfpwxKCFr4WUZixzZgmIG50fQOIsqL6BwA+q3vLvQw5UoedqvUPFKsTs7icyqBc/RJXq8gbadl9ImPkUtJMKHOBWf+1B5Z5dEB7aBvRw+RnQxqOumaKhBOSDeGytMu5GJ3dt20iRjg+LmTuED9M7XVfILKmRwZv1tivS9wwnv7b8oY3+Uc2j+KaWWYDgn2x3lB0MtSzFw8dM1pHTqBfycbJNPfmGMeT8fs9s5GCeuKo7XlREvtpMrfNQOoy9WwTW6svGt+re0K2ZJXqI8lV2Cp5OtoB+cys7qoyX0cyqbZlfX57Ym/Q2/BRgAxOn0Cwpi9kwAAAAASUVORK5CYII=) no-repeat; 
      display: inline-block; 
      width: 45px; 
      height: 21px; 
      margin-bottom: 2px;
    }

- content_for :included_javascripts do
  = javascript_include_tag 'jquery-1.7.2.min'
  :javascript
    $(document).ready(function() {
        var isActionOffer = #{@offer.item_type == 'ActionOffer'};
        var hasActionApp = #{@action_app.present?};
        var hasProtocolHandler = #{@action_app.present? ? @action_app.protocol_handler.present? : false};
        if (isActionOffer && hasActionApp && hasProtocolHandler) {
            var timeout;
            var phUrl = #{@action_app.present? ? @action_app.protocol_handler.to_json.html_safe : ""};
            var fallbackUrl = #{@complete_action_url.to_json.html_safe},
                  appversion = navigator.appVersion,
                  idevice = (/iphone|ipad|ipod/gi).test(appversion),
                  android = (/android/gi).test(appversion);
            if (idevice) {
                var userAgent = navigator.userAgent.toString().toLowerCase();
                chrome = (/crios/gi).test(userAgent);
                if (!chrome) {
                    $('.button-holder').show();
                }
            } else if (android) {
                $('.button-holder').show();
            }
            $('#protocol').bind('click', function() {
                if (phUrl.length > 0) {
                    if (android) {
                        if (navigator.userAgent.match(/Chrome/)) {
                            setTimeout(function() {
                                if (!document.webkitHidden)
                                    window.location = fallbackUrl;
                            }, 1000);
                            window.location = phUrl;
                        } else {
                            var iframe = document.createElement("iframe");
                            iframe.style.border = "none";
                            iframe.style.width = "1px";
                            iframe.style.height = "1px";
                            iframe.onload = function () { window.location = fallbackUrl; };
                            iframe.src = phUrl;
                            document.body.appendChild(iframe);
                        }
                    } else if (idevice) {
                        timeout = setTimeout(function(){
                            var dataParam = #{params[:data].to_json.html_safe};
                            window.location = (#{app_not_installed_offer_instructions_path.to_json.html_safe} + "?data=" + dataParam);
                        }, 1000);
                        window.location = phUrl;
                        window.addEventListener("pageshow", function() {
                            clearTimeout(timeout);
                            location.reload();
                        });
                    }
                }
            });
        }
    });
