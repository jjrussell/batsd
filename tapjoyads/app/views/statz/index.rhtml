<html>
<head>
  <title>Tapjoy Status</title>
  <link rel="stylesheet" href="../stylesheets/themes/blue/style.css" type="text/css" media="print, projection, screen" />
  <style type='text/css'>
    .appkey {
      font-size:50%;
    }
    
    .appname {
      width: 100px;
      overflow: hidden;
    }
  </style>
  <script type="text/javascript" src="/javascripts/jquery-1.4.1.min.js"></script>
  <script type="text/javascript" src="/javascripts/jquery.tablesorter.js"></script>
  <script type="text/javascript">


    $(function() {   
      $("#apps_table").tablesorter({sortList:[[1,0]], widgets: ['zebra']});
    });  
  </script>
</head>
<body>
  <h1>Tapjoy stats for last 24 hours</h1>
  <h3>Total installs: <%= @install_count_24hours %></h3>
  <h5>Last updated: <%= @last_updated %></h5>
  
  <table id="apps_table" class="tablesorter">
    <thead>
    <tr>
      <th></th>
      <th>App</th>
      <th>Paid installs</th>
      <th>Paid clicks</th>
      <th>CVR</th>
      <th>Connects</th>
      <th>New users</th>
      <th>Price</th>
      <th>Payment for install</th>
      <th>Balance</th>
      <th>Daily Budget</th>
      <th>Show rate</th>
      <th>Published installs</th>
      <th>Published clicks</th>
      <th>Ad impressions</th>
    </tr>
    </thead>
    
    <tbody>
    <% @app_list.length.times do |i| %>
      <% app = @app_list[i]; appstats = @appstats_list[i] %>
      <tr class='app'>
        <td>
          <img src="<%= app.get_icon_url %>" width="56px" height="56px" />
        </td>
        <td>
          <div class='appname'>
            <%= app.name %>
            <br />
            <span class='appkey'><%= app.key %></span>
          </div>
        </td>
        
        <td>
          <span title="<%= appstats.stats['paid_installs'].join(', ') %>">
            <%= appstats.stats['paid_installs'].sum %>
          </span>
        </td>
        
        <td>
          <span title="<%= appstats.stats['paid_clicks'].join(', ') %>">
            <%= appstats.stats['paid_clicks'].sum %>
          </span>
        </td>
        
        <td>
          <span title="<%= appstats.stats['cvr'].join(', ') %>">
            <%= "%.2f" % (appstats.stats['paid_installs'].sum.to_f / appstats.stats['paid_clicks'].sum) %>
          </span>
        </td>
        
        <td>
          <span title="<%= appstats.stats['logins'].join(', ') %>">
            <%= appstats.stats['logins'].sum %>
          </span>
        </td>
        
        <td>
          <span title="<%= appstats.stats['new_users'].join(', ') %>">
            <%= appstats.stats['new_users'].sum %>
          </span>
        </td>
        
        <td><%= app.price %></td>
        <td><%= app.payment_for_install %></td>
        <td><%= app.balance %></td>
        <td><%= app.daily_budget %></td>
        <td><%= app.show_rate %></td>
        
        <td>
          <span title="<%= appstats.stats['published_installs'].join(', ') %>">
            <%= appstats.stats['published_installs'].sum %>
          </span>
        </td>
        
        <td>
          <span title="<%= appstats.stats['installs_opened'].join(', ') %>">
            <%= appstats.stats['installs_opened'].sum %>
          </span>
        </td>
        
        <td>
          <span title="<%= appstats.stats['hourly_impressions'].join(', ') %>">
            <%= appstats.stats['hourly_impressions'].sum %>
          </span>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
</body>
</html>