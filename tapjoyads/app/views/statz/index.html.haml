- @page_title = 'Stats for last 24 hours'

- content_for :included_stylesheets do
  = stylesheet_link_tag 'themes/blue/style', 'jquery.autocomplete'

- content_for :included_javascripts do
  = javascript_include_tag 'jquery.tablesorter', 'jquery.autocomplete.min'

%h1 Tapjoy stats for last 24 hours

- form_tag('', :id => 'search_form') do
  = label_tag('search_box', 'Offer Name:')
  = text_field_tag('search_box', '', :size => '30')
  = submit_tag('View Details')

%h3#install_count_24hours= "Total conversions: #{@cvr_count_24hours} &nbsp; Total revenue: #{@ad_spend_24hours} &nbsp; Total payouts: #{@publisher_earnings_24hours}"

#last_updated= "Last Updated: #{@last_updated.in_time_zone('Pacific Time (US & Canada)').to_s(:pub_ampm)}"

%table#apps_table.tablesorter
  %thead
    %tr
      %th
      %th Offer
      %th Conversions
      %th Connects
      %th New users
      %th DAUs
      %th Store rank
      %th Price
      %th Payment
      %th Balance
      %th Pending Earnings
      %th Daily Budget
      %th Platform
      %th Show rate
      %th VG Purchases
      %th Published installs
      %th Installs revenue
      %th Ad impressions
  %tbody#apps_tbody
    - @cached_stats.each do |offer_id, stats|
      %tr
        %td= link_to(image_tag(stats['icon_url'], :size => '56x56'), statz_path(offer_id))
        %td= link_to(stats['offer_name'], statz_path(offer_id))
        %td= stats['conversions']
        %td= stats['connects']
        %td= stats['new_users']
        %td= stats['daily_active_users']
        %td= stats['overall_store_rank']
        %td= stats['price']
        %td= stats['payment']
        %td= stats['balance']
        %td= stats['pending_earnings']
        %td= stats['daily_budget']
        %td= stats['platform']
        %td= stats['show_rate']
        %td= stats['vg_purchases']
        %td= stats['published_installs']
        %td= stats['installs_revenue']
        %td= stats['ad_impressions']
      
-content_for :page_javascript do
  :plain
    $(function() {
      var offer_guid = '';
      $('#search_box').keyup(function(event) {
        if (!(event.keyCode == 9 || event.keyCode == 13)) {
          offer_guid = '';
        }
      });
      $('#search_box').autocomplete('#{search_statz_path}', { cacheLength: 1, autoFill: true, max: 20, delay: 250 });
      $('#search_box').result(function(event, data) {
        offer_guid = data[1];
      });
      $('#search_form').submit(function() {
        window.location.assign('#{statz_index_url}/' + offer_guid);
        return false;
      });
      
      
      $("#apps_table").tablesorter({widgets: ['zebra'],
        headers: {
          0: {sorter: false}
        },
        sortList: [[2, 1]]
      });
    });
  

-content_for :page_styles do
  :plain
    table.tablesorter {
      border-collapse: separate;
    }
    
    table.tablesorter thead tr .header {
      background-position: right bottom;
    }
    
    th, td {
      border: 0;
    }
    
    .appkey {
      font-size:50%;
    }
    
    .appname {
      width: 100px;
      overflow: hidden;
    }
    
    #last_updated {
      font-weight: bold;
      font-size: 14px;
    }
    
    #do_refresh {
      cursor: pointer;
      text-decoration: underline;
      color: #A7A3FF;
    }
    
    .hidden {
      display: none;
    }
