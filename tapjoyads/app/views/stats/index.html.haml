- @page_title = 'Stats for last 24 hours'

- content_for :included_stylesheets do
  = stylesheet_link_tag 'themes/blue/style'

- content_for :included_javascripts do
  = javascript_include_tag 'jquery.tablesorter'

%h1 Tapjoy stats for last 24 hours

%h3#install_count_24hours= "Total installs: #{@install_count_24hours}"
  
#last_updated= "Last Updated: #{@last_updated}"
  
%table#apps_table.tablesorter
  %thead
    %tr
      %th
      %th App
      %th Paid installs
      %th Connects
      %th New users
      %th DAUs
      %th Price
      %th Payment for install
      %th Balance
      %th Daily Budget
      %th Show rate
      %th VG Purchases
      %th Published installs
      %th Installs revenue
      %th Ad impressions
  %tbody#apps_tbody
    - @app_list.each do |app|
      - stats = @appstats_hash[app.key].stats
      %tr
        %td= image_tag(app.get_icon_url, :size => '56x56')
        %td= link_to(app.name, stat_path(app.key))
        %td= stats['paid_installs'].sum
        %td= stats['logins'].sum
        %td= stats['new_users'].sum
        %td= stats['daily_active_users'].sum
        %td= number_to_currency(app.price / 100.0)
        %td= number_to_currency(app.payment_for_install / 100.0)
        %td= number_to_currency(app.balance / 100.0)
        %td= app.daily_budget
        %td= "%.2f" % (app.show_rate || 0)
        %td= stats['vg_purchases'].sum
        %td= stats['published_installs'].sum
        %td= number_to_currency(stats['installs_revenue'].sum / 100.0)
        %td= stats['hourly_impressions'].sum
      
-content_for :page_javascript do
  :plain
    $(function() {
      $("#apps_table").tablesorter({widgets: ['zebra'],
        headers: {
          0: {sorter: false}
        }
      });
    });

-content_for :page_styles do
  :plain
    table.tablesorter {
      border-collapse: separate;
    }
    
    table.tablesorter thead tr .header {
      background-position: right bottom;
    }
    
    th, td {
      border: 0;
    }
    
    .appkey {
      font-size:50%;
    }
    
    .appname {
      width: 100px;
      overflow: hidden;
    }
    
    #last_updated {
      font-weight: bold;
      font-size: 14px;
    }
    
    #do_refresh {
      cursor: pointer;
      text-decoration: underline;
      color: #A7A3FF;
    }
    
    .hidden {
      display: none;
    }