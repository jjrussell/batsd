!!!

%html
  %head
    %meta{ 'http-equiv' => 'Content-Type', :content => 'text/html; charset=utf-8' }
    %link{ :rel => 'shortcut icon', :href => '/favicon.ico', :content => 'image/vnd.microsoft.icon' }
    %title= @page_title.blank? ? 'Tapjoy' : "#{@page_title} - Tapjoy"
    = stylesheet_link_tag 'website', 'jquery-ui-1.8.4.custom', 'themes/blue/style'
    %style{ :type => 'text/css' }
      = yield :page_styles
      :plain
        #acting_as {
          font-size: 0.5em;
          background-color: yellow;
        }
    = yield :page_head
  
  %body
    #main
      #top_nav
        .left
          = link_to image_tag("#{RUN_MODE_PREFIX}tapjoylogo.png"), root_path
        .right
          = current_user.username
          - if current_user.can_manage_account?
            %span#acting_as
              acting as
              = link_to current_partner.name_or_contact_name, partner_path(current_partner)
          |
          = link_to('Logout', logout_path)
        .clear
    
      #tabs
        - tabs = []
        - tabs << { :apps      => apps_path }            if permitted_to?(:index, :apps)
        - tabs << { :reporting => reporting_index_path } if permitted_to?(:index, :reporting)
        - tabs << { :billing   => billing_index_path }   if permitted_to?(:index, :billing)
        - tabs << { :account   => users_path }           if permitted_to?(:index, :users)
        - tabs << { :partners  => partners_path }        if permitted_to?(:index, :partners)
        - # tabs << { :premier   => premier_path }         if permitted_to?(:edit,  :premier)
        - #tabs << { :support   => support_index_path }   if permitted_to?(:index, :support)
        - tabs << { :tools     => tools_path }           if permitted_to?(:index, :tools)
        - tabs << { :statz     => statz_index_path }     if permitted_to?(:index, :statz)
        = navigation(tabs)

      #content
        - flash.each do |name, msg|
          .flash{ :id => "flash_#{name}", :title => "Click to dismiss this message" }
            %strong #{name.to_s.humanize}:
            = msg
        - [:error, :warning, :notice].each do |name|
          - if flash[name].blank?
            .flash.hidden{ :id => "flash_#{name}", :title => "Click to dismiss this message" }
              %strong #{name.to_s.humanize}:
              %span.message &nbsp;
        = yield
        .clear

      #footer
        &copy; #{Time.now.year} Tapjoy, Inc.
        = link_to 'Privacy Policy', '/privacy.html', :target => '_blank'

    = javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.#{'min.' if Rails.env!='development'}js"
    = javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.#{'min.' if Rails.env!='development'}js"
    = javascript_include_tag 'jquery.tablesorter', 'application'
    = yield :included_javascripts

    %script{ :type => 'text/javascript', :charset => 'utf-8' }
      = yield :page_javascript
      - unless Rails.env == 'development'
        :plain
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-5323442-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
