!!!

%html
  %head
    %meta{ 'http-equiv' => 'Content-Type', :content => 'text/html; charset=utf-8' }
    %link{ :rel => 'shortcut icon', :href => '/favicon.ico', :content => 'image/vnd.microsoft.icon' }
    %title= @page_title.blank? ? 'Tapjoy' : "#{@page_title} - Tapjoy"
    = stylesheet_link_tag 'website', 'jquery-ui-1.8.5', 'colorbox', 'themes/blue/style', 'chosen'
    = stylesheet_link_tag 'print', :media => 'print'
    %style{ :type => 'text/css' }
      = yield :page_styles
      :plain
        #acting_as {
          font-size: 0.8em;
          background-color: yellow;
          float: right;
        }
    = yield :page_head
    = render('shared/analytics')
  %body
    #main
      #top_nav
        .left
          - premier_suffix = current_partner.is_premier? ? '_premier' : ''
          = link_to image_tag("#{RUN_MODE_PREFIX}tapjoylogo#{premier_suffix}.png"), "#{DASHBOARD_URL}/"
        .right
          = current_user.username
          |
          - link_text = "<span id='number_of_active_offers'>#{current_partner_active_app_offers.length}</span> active campaigns"
          - link_class = "soft-link #{current_partner_active_app_offers.blank? ? 'inactive' : ''}"
          = link_to_function link_text, '$.noop()', :class => link_class, :id => 'active_campaigns'
          - unless current_partner_active_app_offers.blank?
            #active_campaigns_box.hidden
              %table{:cellspacing => 0}
                %tbody
                  - current_partner_active_app_offers.each do |offer|
                    %tr
                      %td
                        - form_tag toggle_app_offer_path(:id => offer.id, :app_id => offer.item.id) do
                          = check_box_tag("toggle_offer_#{offer.id}", '1', {}, :class => 'toggle_offer')
                      %td
                        = link_to offer.name, url_to_offer_item(offer)
                      %td.offer-type
                        = image_tag(platform_icon_url(offer))
                        = offer.self_promote_only? ? '[SELF]' : ''
                      %td
                        = number_to_currency(offer.bid / 100.0)

          |
          - if premier_enabled?
            = mail_to "premiersupport@tapjoy.com", "Support", :subject => "Premier Support"
            |
          = link_to('Knowledge Center', KNOWLEDGE_CENTER_URL)
          |
          = link_to('Dev forum', DEV_FORUM_URL)
          |
          = link_to('Logout', logout_path)
        .clear
        - if current_user.can_manage_account?
          %span#acting_as
            - form_tag('') do
              acting as
              = select_tag(:recent_partners, options_for_select(@recent_partners))
              = link_to('Partner page', partner_path(current_partner))

      #tabs
        - tabs = []
        - tabs << { :apps      => apps_path }            if permitted_to?(:index, :apps)
        - tabs << { :reporting => reporting_index_path } if permitted_to?(:index, :reporting)
        - tabs << { :billing   => billing_index_path }   if permitted_to?(:index, :billing)
        - tabs << { :account   => users_path }           if permitted_to?(:index, :users)
        - tabs << { :partners  => partners_path }        if permitted_to?(:index, :partners)
        - tabs << { :inventory => inventory_management_index_path } if permitted_to?(:index, :inventory_management)
        - tabs << { :premier   => premier_path }         if permitted_to?(:edit,  :premier) and current_partner.is_premier?
        - tabs << { :tools     => tools_path }           if permitted_to?(:index, :tools)
        - tabs << { :ops       => ops_path }             if permitted_to?(:index, :ops)
        - tabs << { :statz     => statz_index_path }     if permitted_to?(:index, :statz)
        = navigation(tabs)

      #content
        - flash.each do |name, msg|
          .flash{ :id => "flash_#{name}", :title => "Click to dismiss this message" }
            %strong #{name.to_s.humanize}:
            = msg
        - [:error, :warning, :notice].each do |name|
          - if flash[name].blank?
            .flash.hidden{ :id => "flash_#{name}", :title => "Click to dismiss this message" }
              %strong #{name.to_s.humanize}:
              %span.message &nbsp;
        = content_for_exists?(:apps_layout) ? yield(:apps_layout) : yield
        .clear

      #footer
        &copy; #{Time.now.year} Tapjoy, Inc.
        = link_to 'Privacy Policy', "#{WEBSITE_URL}/privacy.html", :target => '_blank'

    = javascript_include_tag 'jquery-1.4.2.min', 'jquery-ui-1.8.5.min', 'jquery.tablesorter', 'jquery.colorbox.min', 'application', 'chosen.jquery', 'facebox'
    = yield :included_javascripts

    %script{ :type => 'text/javascript', :charset => 'utf-8' }
      = yield :page_javascript
      :plain
        jQuery(document).ready(function($) {
          $('a[rel*=facebox]').facebox({
            closeImage   : '/images/closelabel.png'
          });

        });

        $(function ($) {
          $('#recent_partners').change(function () {
            var form = $(this).parent('form');
            var url = $(this).val();
            form.attr('action', url);
            form.submit();
          });
        });
