- @page_title = 'Partners'

%h1 Partners

- form_tag(partners_path, :method => :get, :class => 'tjform') do
  = label_tag(:q, "Name or Email Address:")
  = text_field_tag(:q, params[:q], :size => '40')
  = submit_tag('Search')

%table#partners_table.tablesorter
  %thead
    %tr
      %th Name
      %th Email(s)
      %th Phone
      %th Balance
      %th Pending Earnings
      %th{ :class => params[:q].blank? ? 'up_arrow' : '' } Created
      %th Offers
  %tbody
    - @partners.each do |partner|
      %tr{ :class => cycle('even', 'odd') }
        %td.nowrap= link_to(partner.name || 'Unknown', partner_path(partner))
        %td= partner.users.map(&:email).join(', ')
        %td.nowrap= partner.contact_phone
        %td= number_to_currency(partner.balance / 100.0)
        %td= number_to_currency(partner.pending_earnings / 100.0)
        %td.nowrap= partner.created_at.in_time_zone('Pacific Time (US & Canada)').to_s(:pub_ampm_sec) + " PT"
        %td
          - partner.offers.each do |o|
            .offer
              = image_tag(o.get_icon_url(request.protocol), :size => '20x20')
              = link_to(o.name_with_suffix, statz_path(o.id))
              - if o.tapjoy_enabled? || o.user_enabled?
                = '(' + (o.tapjoy_enabled? ? 'T' : '') + (o.user_enabled? ? 'U' : '') + ')'

= will_paginate(@partners)

- content_for :page_styles do
  :plain
    table.tablesorter {
      border-collapse: separate;
    }
    
    table.tablesorter th.up_arrow {
      background-position: 100% 50%;
      background-repeat: no-repeat;
      background-image: url(/stylesheets/themes/blue/asc.gif);
      background-color: #8DBDD8;
    }
    
    .offer {
      display: inline-block;
      padding-right: 10px;
      padding-top: 5px;
    }
    
    .nowrap {
      white-space: nowrap;
    }
    
    .tjform input[type=submit] {
      margin: 0;
      float: none;
    }
