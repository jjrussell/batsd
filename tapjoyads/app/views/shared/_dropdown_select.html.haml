- return if objects.blank?
- extra_url_params ||= nil
#selected_app{ :title => "Select your app" }
  - if selected.nil?
    = image_tag('new_app', :size => '24x24', :alt => '')
    Add a new App
  - else
    = image_tag(selected.get_icon_url(request.protocol), :size => '24x24', :alt => '')
    = selected.name
#apps_dropdown.hidden
  - if false
    #search_box
      Search:
      = text_field_tag(:app_name)
  - objects.each do |o|
    - url = o.class.to_s == 'App' ? app_path(o, extra_url_params) : reporting_path(o, extra_url_params)
    - class_name = o == selected ? "selected" : ""
    .app{ :class => class_name, :title => o.name }
      = image_tag(o.get_icon_url(request.protocol), :size => '24x24', :alt => '')
      = o.name
      = link_to('#', url, :class => "hidden")
  .app{ :class => "new_app #{selected.nil? ? 'selected' : ''}", :title => 'Add a new App' }
    = image_tag('new_app', :size => '24x24', :alt => '')
    Add a new App
    = link_to('#', new_app_path, :class => "hidden")
.clear
- content_for :page_styles do
  :plain
    .hidden {
      display: none;
    }
    #selected_app {
      margin-top: 5px;
      border: 1px solid #888;
      -moz-border-radius: 4px;
      -webkit-border-radius: 4px;
      width: 480px;
      height: 24px;
      vertical-align: middle;
      float: right;
      color: #222;
      font-size: 16px;
      text-decoration: none;
      text-shadow: 0px 1px 1px #fff;
      padding: 7px 0px;
      background: #ddd;
      background: -webkit-gradient(linear, left top, left bottom, color-stop(0.0, #fff), color-stop(0.5, #ddd), color-stop(1.0, #fff));
      background: -moz-linear-gradient(top, #fff, #ddd, #fff);
    }
    #selected_app:hover {
      background: #ccc;
      background: -webkit-gradient(linear, left top, left bottom, color-stop(0.0, #eee), color-stop(0.5, #ccc), color-stop(1.0, #eee));
      background: -moz-linear-gradient(top, #eee, #ccc, #eee);
    }
    #selected_app img, .app img {
      vertical-align: middle;
      margin: 0px 10px;
    }
    #search_box {
      padding: 5px 10px;
      height: 24px;
    }
    #apps_dropdown {
      background-color: #eee;
      border: 1px solid #888;
      -moz-border-radius: 4px;
      -webkit-border-radius: 4px;
      position: absolute;
      width: 480px;
      max-height: 320px;
      padding: 3px 0px;
      overflow-y: auto;
    }
    .app {
      color: #222;
      text-shadow: 0px 1px 1px #fff;
      overflow-x: hidden;
      white-space: nowrap;
      padding: 5px 5px;
      height: 24px;
    }
    .app.selected {
      background: #337BC8;
      background: -webkit-gradient(linear, left top, left bottom, from(#37ADE0), to(#337BC8));
      background: -moz-linear-gradient(top, #37ADE0, #337BC8);
      color: #fff;
      text-shadow: 0px 1px 1px #6D6C9E;
    }
    .app:hover {
      background: #bbb;
    }
    .app img {
      opacity: 0.75;
    }
    .app:hover img, .app.selected img {
      opacity: 1.0;
    }
    input#app_name {
      width: 360px;
    }
- content_for :page_javascript do
  :plain
    $(function($){
      $('#selected_app').click(function(){
        var offset = $('#selected_app').offset();
        if (offset) {
          offset.top += $(window).scrollTop();
          $('#apps_dropdown').css({ left: offset.left, top: offset.top });
        }
        $('#apps_dropdown').show();
        $('#apps_dropdown input#app_name').focus();
      });

      $(document).click(function(e){
        if (e.srcElement) {
          if ($(e.srcElement).hasClass('app')) {
            $('#apps_dropdown').hide();
            if (!$(e.srcElement).hasClass('selected')) {
              // switch apps
              $('.app.selected').removeClass('selected');
              $(e.srcElement).addClass('selected');
              $('#selected_app').html($(e.srcElement).html());
              location.href = $(e.srcElement).children('a').attr('href');
            }
          } else {
            var id = $(e.srcElement).attr('id');
            if (id != 'selected_app' && id != 'app_name') {
              $('#apps_dropdown').hide();
            }
          }
        }
      }).keydown(function(e){
        // 27 = escape
        if (e.which == 27) {
          $('#apps_dropdown').hide();
        }
      });
    });
