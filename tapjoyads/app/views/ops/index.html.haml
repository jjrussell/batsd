- @page_title = 'Operations Dashboard'

- content_for :page_sidebar do
  - unless @kiosk
    .span2
      .well.sidebar-nav
        %ul.nav.nav-list
          %li.nav-header more info Â»
          %li.active= link_to 'dashboard', ops_path
          %li= link_to 'auto-scaler', as_groups_ops_path
          %li= link_to 'load-balancer', elb_status_ops_path
          %li= link_to 'service-stats', service_stats_ops_path
          %li= link_to 'vertica-status', vertica_status_ops_path
          %li= link_to 'kiosk-mode', ops_path(:kiosk => true)

= javascript_tag do
  :plain
    var nodes = [];

    this.node_cleanup_timer = setInterval(function () {
      for (var instance_id in nodes) {
        var current_time = new Date().getTime();
        var timestamp = nodes[instance_id];
        if (current_time - timestamp > 35000) {
          $('#' + instance_id + '_details').remove();
          delete nodes[instance_id];
        }
      }
    }, 1000);

%div{:class => @kiosk ? "" : "span10"}
  .row-fluid
    %div{:class => "#{@kiosk ? 'span2' : 'span3'}", :id => "api-rpm-per-server"}
      %span.label.right rpm
      .well.well-small
        %div
          %h1
            %span{:id => "api-rpm-per-server-count"} Loading
            - content_for :page_javascript do
              :plain
                $("#api-rpm-per-server-count").load("ops/requests_per_minute?average=true");
                this.timer_api_rpm_per_server_count = setInterval(function () {
                  $("#api-rpm-per-server-count").load("ops/requests_per_minute?average=true");
                }, 5000);
            %small per server
    %div{:class => "#{@kiosk ? 'span2' : 'span3'}", :id => "api-rpm-total"}
      %span.label.right rpm
      .well.well-small
        %div
          %h1
            %span{:id => "api-rpm-total-count"} Loading
            - content_for :page_javascript do
              :plain
                $("#api-rpm-total-count").load("ops/requests_per_minute");
                this.timer_api_rpm_total = setInterval(function () {
                  $("#api-rpm-total-count").load("ops/requests_per_minute");
                }, 5000);
            %small total
    - @as_groups.each do |group|
      %div{:class => "#{@kiosk ? 'span2' : 'span3'}", :id => "#{group[:auto_scaling_group_name]}_section"}
        .well.well-small
          %div{:id => "#{group[:auto_scaling_group_name]}_header"}
          - content_for :page_javascript do
            :plain
              $("##{group[:auto_scaling_group_name]}_header").load("ops/as_header?group=#{group[:auto_scaling_group_name]}");
              this.timer_#{group[:auto_scaling_group_name]}_header = setInterval(function () {
                $("##{group[:auto_scaling_group_name]}_header").load("ops/as_header?group=#{group[:auto_scaling_group_name]}");
              }, 30000);

          %div{:id => "#{group[:auto_scaling_group_name]}_instances"}
          - content_for :page_javascript do
            :plain
              $("##{group[:auto_scaling_group_name]}_instances").load("ops/as_instances?group=#{group[:auto_scaling_group_name]}#{@kiosk ? "&kiosk=true" : ""}");
              this.timer_#{group[:auto_scaling_group_name]}_instances = setInterval(function () {
                $("##{group[:auto_scaling_group_name]}_instances").load("ops/as_instances?group=#{group[:auto_scaling_group_name]}#{@kiosk ? "&kiosk=true" : ""}");
              }, 30000);

- content_for :included_javascripts, javascript_include_tag('ajax-links.js')

- content_for :page_styles do
  :plain
    table.tablesorter {
      border-collapse: separate;
    }

    .details {
      width: 310px;
      margin-left: 5px;
      margin-right: 5px;
      font-size: 11px;
    }

    .lowbreaching {
      color: #ff0000 !important;
    }

    .highbreaching {
      color: #008000 !important;
    }

    #content a:visited {
      color: blue;
    }
    #content a:hover {
      color: yellow;
    }
    #content a {
      color: blue;
    }
    .progress {
      margin-bottom: 0px !important;
    }
    .center {
      text-align: center;
    }
    .labels {
      padding: 3px 3px 0px 3px;
    }
    h3 {
      margin-bottom: 2px;
    }
    .row-fluid > [class*="span"]:nth-child(#{@kiosk ? '6' : '4'}n+1) {
      margin-left: 0;
      clear: both;
    }

    th.name {
      width: 65%;
    }
